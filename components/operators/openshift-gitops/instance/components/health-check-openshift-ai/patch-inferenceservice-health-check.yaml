- op: add
  path: /spec/resourceHealthChecks/-
  value:
    group: serving.kserve.io
    kind: InferenceService
    check: |
      health_status = {}
      health_status.status = "Progressing"
      health_status.message = "Waiting for InferenceService to report status..."

      if obj.status ~= nil then
        progressing = false

        if obj.modelStatus ~= nil then
          if obj.modelStatus.transitionStatus == "InProgress" then
            progressing = true
          end
        end
        
        if obj.status.conditions ~= nil then
          msg = ""

          for i, condition in pairs(obj.status.conditions) do

            status_false = 0
            status_unknown = 0

            if condition.status == "Unknown" then
              status_unknown = status_unknown + 1
            elseif condition.status == "False" then
              status_false = status_false + 1
            end

            if condition.status ~= "True" then
              msg = msg .. i .. ": " .. condition.type .. " | " .. condition.status
              if condition.reason ~= nil and condition.reason ~= "" then
                msg = msg .. " | " .. condition.reason
              end
              if condition.message ~= nil and condition.message ~= "" then
                msg = msg .. " | " .. condition.message
              end
              msg = msg .. "\n"
            end

          end

          if progressing == false and status_unknown == 0 and status_false == 0 then
            health_status.status = "Healthy"
          elseif progressing == true then
            health_status.status = "Progressing"
          else
            health_status.status = "Degraded"
          end

          health_status.message = msg
        end
      end

      return health_status
